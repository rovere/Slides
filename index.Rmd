---
title       : DQM GUI Ideas
subtitle    : Possible extension to make DQM GUI a  distributed service
author      : M. Rovere, PH-CMG-CO, CERN
job         : CERN
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : prettify      # {highlight.js, prettify, highlight}
hitheme     : twitter-bootstrap # sunburst      #
widgets     : [mathjax]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone,draft}

--- .segue .dark .nobackground

## Motivation

---

## Many Requirements, One application

### <font class='red bold'>Offline</font> Requirements

1. Quickly digest all data coming in from Tier-0
1. Handle a huge volume of data (~2.5TB)
1. Handle a huge number of samples
1. Quickly digest all data coming from reprocessing

### <font class='red bold'>RelVal</font> Requirements

1. Handle a huge number of histograms
1. Quickly digest Relval samples injected by WMAgent
1. Moderate data volume (~1TB)

### <font class='red bold'>Online</font> Requirements

1. Live feedback from Online DQM Apps
1. Small number of samples
a. Small disk size

<font class='red bold'>These requirements will be extended to even
higher values in Run2 and Phase1&2 upgrades</font>

---

## How to satisfy requirements

### <font class='red bold'>Offline</font>

1. Buy performant/expensive dedicated hardware
1. Design a fast application

### <font class='red bold'>RelVal</font>

1. Buy performant/expensive dedicated hardware
1. Design a fast application

### <font class='red bold'>Online</font>

1. Design a fast application
1. Use dedicated/fast network protocol to transmit histograms in live mode.

---

## Scaling

### General considerations

- While buying new hardware is a legittimate step, it is clear that it
is not going to scale in the longish term
   - computing is going in the opposite direction:
       - multi-threading and parallelisation
       - <font class='red bold'>horizontal scaling</font>

- DQM GUI is no exception in this respect

- CERN IT is less and less willing to buy, configure and handle dedicated hardware

- vocms138 and vocms139 are already <font class='red bold'>out of
  warranty</font> and will soon be retired

- <font class='blue bold'>Need to find adeguate replacements, trying
  to satisfy all needs, keeping the highest possible performances,
  possibly improving the system</font>

- In this process, I started to think what DQM GUI could be in the
  (maybe not so near) future.

---

## Scaling

### Viable Approaches

- Invest in hardware (vertical scaling)
- Invest in software (horizontal scaling)
   - Swap the current backend with a viable distributed backend
   - Modify the current backend to be a distributed backend




|                                        | Hardware                                                                                                     | Software/Open Source distributed backend                                                                                | Software/Make current backend distributed                       |
|----------------------------------------|--------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------- |
| <font class='red bold'>CONS</font>     | Expensive                                                                                                    | Big evaluation time                                                     					          | Non-negligible development effort                               |
|                                        | Not the preferred solution from IT                                                                           | Development integration time                                                                                            |                                                                 |
|                                        | Additional load on us, since they would outsource the  configuration/handling/alarming of commodity hardware | steep learning curve (see, e.g., ongoing effort for Conditions in CMSSW)                                                |                                                                 |
| <font class='green bold'>PROS</font>   | No software development                                                                                      | Solid rock/tested/community supported software                                                                          | Start from a solid-rock code                                    |
|                                        |                                                                                                              |                                                                                                                         | Affordable learning curve                                       |
| <font class='blue bold'>REMARKS</font> |                                                                                                              | <font class='yellow3 bold'>PREFERRED CHOICE FOR LONG TERM</font> (technical student?)                                   | <font class='green bold'>PREFERRED CHOICE FOR SHORT TERM</font> |

---

## Switch to Virtual Machines

### Current situation/proposal

Moving the current produciton servers to Virtual Machines is not an immediate step.

- Current production servers have hardware RAID 6 to cope with
single(multiple) disk failures.

- The current read/write on disk capabilities are ~700/~350 MB/s(read/write), not
reproducible using a VM with an ordinary disk attached.

- Few solutions have been explored during a dedicated meeting with IT guys.
   - I will put together an ad-hoc test suite to measure reasonable performances of the current servers
   - Compare these numbers with the proposed solutions
   - Try to come up with some reasonable requirements from CMS
       - As fast as possible is not a <font class='red bold'>good</font> metric. 

- <font class='yellow bold'>Good occasion to re-think a bit the DQM GUI applications and give a
  thought about what could be done to cope with less performant
  operating hardware</font>

--- &singleimage w1:100 image:images/OfflineAgentsChainLocal.png

## Possible scaling

### How to scale
1. if single hardware is not enough to cope, spread load on multiple servers

1. even better if you spread the <font class='red bold'>most intensive
operations (read indexing)</font>

1. DQM GUI is a perfect example, since `indexing` is a simple serial queue

1. We have been file-based since RunI.

--- &singleimage w1:50 image:images/DQM_GUI_servers.png

## Current Architecture

--- &twoimages w1:45 w2:50 imageleft:images/DQM_GUI_servers_distributed.png imageright:images/OfflineAgentsChainDistributed.png

## Possible Distributed Architecture

---

## Challanges

### Main challanges
1. Internal coherence of DQM GUI (relatively easy)
1. External coherence versus exposed "dynamic" URL (RelMon example)
1. External coherence versus the already exposed API

