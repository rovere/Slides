---
title       : Tracking Training Day - II
subtitle    : The Revenge
author      : G.Cerati, V.Innocente, M.Rovere 
job         : CERN
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : prettify      # {highlight.js, prettify, highlight}
hitheme     : twitter-bootstrap # sunburst      #
widgets     : [mathjax]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone,draft}

---

## Goals

We hope that, by today, you will become proficient in

* locate and browse tracking-related code
* find samples for development and testing
* run track reconstruction sequence (default or modified)
    * check also timing and memory usage
* refit tracks
* analyze tracks using EDM root files and plain ROOT
* analyze tracks with EDAnalyzer
    * select tracks
    * track parameters and `HitPattern`
    * hits and track hits
    * seeds and trajectories
* run track validation code
    * MultiTrackValidator
* Advanced debugging

--- .segue .dark .nobackground

## Prerequisites

---

## Setup a development area

We will be working with `CMSSW_7_2_0` release, using some ad-hoc
package that we have prepared for this training.

* Setup a development aread

<pre data-lang="shell">
<b>ssh -Y lxplus.cern.ch</b>
cd scratch0
mkdir TrackingTutorial
cd TrackingTutorial
<b>cmsrel CMSSW_7_2_0
cd CMSSW_7_2_0/src
cmsenv</b>
</pre>

* To facilitate the access to your own github repository w/o
  constantly typing your passphrase, do:

<pre data-lang="shell">
eval `ssh-agent`
ssh-add
</pre>

* Setup an empty git repository for the CMSSW area you just created

<pre data-lang="shell">
git cms-init
</pre>

* Add the code for the Tracking Training Day II

<pre data-lang="shell">
git submodule add git@github.com:/rovere/TTD TTD
</pre>

--- .segue .nobackground .dark

## Locate and browse tracking code

---

## Tracking Packages

* The main tracking packages are:
    * <font class="bold red">DataFormats</font>
        * [TrackReco](https://cmssdt.cern.ch/SDT/lxr/source/DataFormats/TrackReco/), [TrajectorySeed](https://cmssdt.cern.ch/SDT/lxr/source/DataFormats/TrajectorySeed/), [TrackingRecHit](https://cmssdt.cern.ch/SDT/lxr/source/DataFormats/TrackingRecHit/), ...
    * <font class="bold red">RecoTracker</font>
        * contains the bulk of the reconstruction code
    * <font class="bold red">TrackingTools</font>
        * common utilities shared with muon tracking
* The recommended access point to browse code is `CMSSW LXR` main page at [https://cmssdt.cern.ch/SDT/lxr/](https://cmssdt.cern.ch/SDT/lxr/)
    * it is much more that a code browser and allows you to, e.g.:
        * search specific identifiers (class, variable, functions, ...)
        * follow code by clicking directly into the code
        * free text search with (limited) regexp capabilities
* Let's open few of them:
    * [https://cmssdt.cern.ch/SDT/lxr/source/DataFormats/TrackReco/interface/Track.h](https://cmssdt.cern.ch/SDT/lxr/source/DataFormats/TrackReco/interface/Track.h) 
    * [https://cmssdt.cern.ch/SDT/lxr/source/RecoTracker/IterativeTracking/python/iterativeTk_cff.py](https://cmssdt.cern.ch/SDT/lxr/source/RecoTracker/IterativeTracking/python/iterativeTk_cff.py) 
    * [https://cmssdt.cern.ch/SDT/lxr/source/DataFormats/TrajectorySeed/interface/TrajectorySeed.h](https://cmssdt.cern.ch/SDT/lxr/source/DataFormats/TrajectorySeed/interface/TrajectorySeed.h) 
    * [https://cmssdt.cern.ch/SDT/lxr/source/TrackingTools/PatternTools/interface/Trajectory.h](https://cmssdt.cern.ch/SDT/lxr/source/TrackingTools/PatternTools/interface/Trajectory.h) 

--- .segue .nobackground .dark
## Sample Discovery

---
## Finding samples

* We will use the official CMS sample-discovery tool, DAS, via its CLI, `das_client.py`

* The best samples for developing and testing Tracking are RelVal.

* Typical developments do not need huge datasets: RelVals are made for
every (pre-) release and thus are always up to date.

    * <font class="bold yellow">They contain all the information
      needed (clusters, tracks, mc truth) that won’t be available on
      other samples.</font>

* Let’s start from a <font class="bold red">SingleMu</font> sample. We want it to be at CERN for a quick access:

<pre>
das_client.py --query='dataset dataset=/RelValSingleMu*/*CMSSW_7_2_0*/GEN-SIM-RECO' --format=plain --limit=0
</pre>

* Now, let’s choose Pt100 and find the files:

<pre>
das_client.py --query='file dataset=/RelValSingleMuPt100_UP15/CMSSW_7_2_0_pre3-POSTLS172_V3-v1/GEN-SIM-RECO' \
--format=plain \
--limit=0
</pre>

* Another useful sample is <font class="bold red">TTbar</font>:

<pre>
das_client.py --query='dataset dataset=/RelValTTbar*/*CMSSW_7_2_0*/GEN-SIM-RECO' \
--format=plain \
--limit=0
</pre>

---
## Finding samples

* Let’s pick the 13TeV inclusive sample with PU:

<pre>
das_client.py --query='file dataset=/RelValTTbar_13/CMSSW_7_2_0_pre5-PU25ns_POSTLS172_V3-v1/GEN-SIM-RECO' \
--format=plain \
--limit=0
</pre>

* For validation we will need also the GEN-SIM-DIGI-RAW-HLTDEBUG
  files:
    *  <font class="bold red">SingleMu</font>
<pre>
das_client.py \
--query='file dataset=/RelValSingleMuPt100_UP15/CMSSW_7_2_0_pre3-POSTLS172_V3-v1/GEN-SIM-DIGI-RAW-HLTDEBUG' \
--format=plain \
--limit=0
</pre>
    *  <font class="bold red">TTbar</font>
<pre>
das_client.py \
--query='file dataset=/RelValTTbar_13/CMSSW_7_2_0_pre5-PU25ns_POSTLS172_V3-v1/GEN-SIM-RAW-HLTDEBUG' \
--format=plain \
--limit=0
</pre>


--- .segue .nobackground .dark
## Run Track Reconstruction

--- .segue .nobackground .dark
## Refit Tracks

--- .segue .nobackground .dark
## Analyze Tracks in plain ROOT

--- .segue .nobackground .dark
## Analyze Tracks with EDAnalyzer

--- .segue .nobackground .dark
## Run Track Validation Code

--- .segue .nobackground .dark
## Advanced Debugging

--- &thankyou
## Thank you!

Questions & Answers

