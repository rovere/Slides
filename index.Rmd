---
title       : New Vertex Validation Package
subtitle    : Tracking POG Meeting, 2014-08-11
author      : M. Rovere, CERN
job         : CERN
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : prettify      # {highlight.js, prettify, highlight}
hitheme     : twitter-bootstrap # sunburst      #
widgets     : [mathjax]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone,draft}

---

## Introduction

### Purpose

These slides will explain
* the plots produced centrally by the PV Vertex validation package
* how they are organised
* how they are produced and filled
* how to run only this part of the full validation sequence in an effortless way, almost in standalone mode.

### Current situation

* The package lives under ```Validation/RecoVertex```
* The code entered ```720pre2``` and is run be default using the standard ```VALIDATION``` step in ```cmsDriver.py```
* A porting of this code into ```SLHC``` release is ready and currently under validation.

---

## Histograms Organization

* Histograms are divided into folders.

* The root folder for the most generic plots is configurable via the
parameter ```root_folder```, with a default value of <font class="red
bold">Validation/Vertices</font>.  The plots that are contained here
belong to two categories:

### Plots related to all Simulated Primary Vertices

Here we mean the real PV of the interaction plus all the PVs coming
from the in-time PU events. The simulated PV coming from the
out-of-time events are not included into these plots. The prefix for
these kind of plots is ```GenAllV_```.

### Plots related only to the real Simulated Primary Vertex

Here we only use the first vertex coming from bunch-crossing 0 and
event 0 in that bunch crossing. The prefix for these kind of plots is
```GenPV_```.

---

## Histograms Naming - Gen Level -

* Under the root folder, there are <font class="bold">as many folders
as ReconstructedParimaryVertex selectors have been defined in the
input configuration to the module via the parameter
(```cms.VInputTag```) ```vertexRecoCollections```</font>.

* Each folder will have exactly the same number
of histograms filled using the selected input collection.

* The histograms contained in each subfolder can be categorised
looking at the prefix in their name, as explained here and in the
following pages.

    * <font class="bold red">GenAllAssoc2Reco_</font>: these plots are
      used as <font class="bold blue">denominators for efficiency and
      duplicate plots</font>. We kind of duplicate plots here with
      respect to the ones contained in the main folder labelled with
      prefix ```GenAllV_``` in case we want to perform more detailed
      studies on a selection of generated vertices, not on all of
      them.

    * <font class="bold red">GenAllAssoc2RecoMatched_</font>: these
      plots are filled with information coming from all <font
      class="blue">simulated vertices</font> that are matched to a
      reconstructed vertex. These plots are used as <font class="bold
      blue">numerators for efficiency plots</font>. The matching is
      currently done based on both a cut on the absolute distance
      between the two vertices and the significance of
      z-separation. In future we plan to add also a matching based on
      the number of matched tracks belonging the the reconstructed
      vertex and the simulated one. All parameters are configurable.

    * <font class="bold red">GenAllAssoc2RecoMultiMatched_</font>:
      these plots are used as <font class="bold blue">numerators to
      compute the duplicate rate</font> for reconstructed
      vertices. They are filled with information coming from <font
      class="blue">simulated vertices</font> that have been associated
      to more than one reconstructed track.

---

## Histograms Naming - Reco Level -

* Histograms derived from <font class="blue">reconstructed
  vertices</font>.

    * <font class="bold red">RecoAllAssoc2Gen_</font>: these are used
      as <font class="bold blue">denominator to compute the fake,
      merge and duplicate rate</font>. These plots are filled with
      information coming from all <font class="blue">reconstructed
      vertices</font> belonging to the specific vertex collection used
      in input in the specific subfolder.

    * <font class="bold red">RecoAllAssoc2GenMatched_</font>: these
      plots are used as <font class="bold blue">numerators to compute
      the fake rate</font> (in fact it's 1 - this_entries that is the
      true value used as the numerator for the fake rate, which
      basically represents the reco vertices that have not been
      associated to any simulated vertex, hence they are fake) and are
      filled with information coming from the <font
      class="blue">reconstructed vertices</font> that have been
      associated to a simulated vertex.

    * <font class="bold red">RecoAllAssoc2GenMultiMatched_</font>:
      these plots are used as <font class="bold blue">numerators to
      compute the merge rate</font> and are filled with information
      coming from the <font class="blue">reconstructed vertices</font>
      that have been associated to more than one simulated vertex.

---

## Histograms Explanation

* The typical plots that are produced are:

    * <font class="bold red">Efficiency plots</font>: these plots are
     the ratio between the reconstructed vertices that have been
     associated to at least one generated vertex, divided by the
     corresponding plot filled with info coming from all the generated
     vertices plot.

    * <font class="bold red">Fake rate plots</font>: these plots
      represent the number of fake vertices, i.e. the number of
      reconstructed vertices that have not been associated to any
      simulated vertex.

    * <font class="bold red">Duplicate rate plots</font>: these plots
      represent the amount of vertices that have been reconstructed
      more than once. They are obtained using as numerator a histogram
      filled with information coming from simulated vertices that have
      been associated to more than one reconstructed vertex (hence the
      meaning of duplicate rate), and as denominator the whole set of
      reconstructed vertices.

    * <font class="bold red">Merge rate plots</font>: these plots
      represent the probability of having 2 different simulated
      vertices reconstructed as a single vertex. It is obtained by
      dividing a histogram filled with info coming from reconstructed
      vertices that have been associated to more than one simulated
      vertex, divided by the total number of reconstructed vertices.

---

## Monitored Variables

* Each of the previous plot is plotted as a function of a parameter. The ones currently used are:

    * Pt_2 of the vertex
    * Z position of the vertex
    * R position of the vertex
    * Number of vertices in the event
    * Number of tracks associated to the vertex
    * distance to the closest in z vertex

## Eff., Fake, Duplicate and MergeRate

* All efficiency, fake, duplicate and merge plots are produced in the
<font class="bold blue">harvesting step using the DQMGenericClient module</font>.

* Instead of pasting few command and python snippets here, I included a
README file under the test directory with rather detailed information
on how to run this validation module and its harvesting twin in
standalone-like mode. [Here](https://github.com/cms-sw/cmssw/blob/CMSSW_7_2_X/Validation/RecoVertex/test/README_VertexValidationSlimmed.txt) you can find the link.

* There is also a TWiki page
  [here](https://twiki.cern.ch/twiki/bin/view/CMS/TrackingVertexValidatorSlimmed)
  that contains all the information that I tried to include in this
  talk.


--- &thankyou

## Thank you!

Questions & Answers

--- .segue .dark .nobackground

## Backup

--- .bigger

## Links to supporing material/talks/slides

In reverse cronological order:

* [Kevin's Talk at the Upgrade Week in Karlsruhe](https://indico.cern.ch/event/294765/session/25/contribution/23/material/slides/0.pdf)
* [Andrea's Talk at Phase1/2 Upgrade Simulation Meeting](https://indico.cern.ch/event/305423/session/3/contribution/4/material/slides/1.pdf)
* [Marco's Talk at the Upgrade TP Performance Studies](https://indico.cern.ch/event/322595/contribution/14/material/slides/0.pdf)
* [Kevins' Talk at the Workshop at Fermilab](https://indico.cern.ch/event/305314/contribution/1/material/slides/0.pdf)
* [Marco's Talk at the Upgrade TP Performance Studies](https://indico.cern.ch/event/314557/contribution/6/material/slides/0.pdf)
* [Giuseppe's slides for ECFA2013](https://indico.cern.ch/event/309894/contribution/6/material/0/0.pdf)



--- .segue .dark .nobackground

## Additional Plots

--- &twoimages w1:47 w2:47 imageleft:images/ptresvseta_ttbar_phs1phs2.png imageright:images/dzresvseta_ttbar_phs1phs2.png

## Resolutions for different samples

--- &fourboxes w1:45 w2:45 w3:45 w4:45 imageleft_up:images/trkfake_ttbar_phs1age_eta_hp_pt09.png imageright_up:images/trkfake_ttbar_phs1phs2_eta_hp_pt09.png imageleft_down:images/trkdup_ttbar_phs1age_eta_hp_pt09.png imageright_down:images/trkdup_ttbar_phs1phs2_eta_hp_pt09.png

## Individual Fake and Duplicate rates

--- &fourboxes w1:45 w2:45 w3:45 w4:45 imageleft_up:images/trkfake_ttbar_phs1age_eta_hp.png imageright_up:images/trkfake_ttbar_phs1phs2_eta_hp.png imageleft_down:images/trkdup_ttbar_phs1age_eta_hp.png imageright_down:images/trkdup_ttbar_phs1phs2_eta_hp.png

## Individual Fake and Duplicate rates - Looser cuts

--- .smaller

## Details of reco configuration - Seeding

* InitialStep (High pT quad step)
    * [main cfg](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/initialStepSeeds.html)
	* [used layers](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/pixellayertriplets.html)
	* [quad-seed](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/pixelseedmergerlayers.html)
* HighPtTripletStep
    * [main cfg](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/highPtTripletStepClusters.html)
    * [used layers](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/highPtTripletStepSeedLayers.html)
* LowPtQuadStep
    * [main cfg](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/lowPtQuadStepSeeds.html)
	* [used layers](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/lowPtQuadStepSeedLayers.html)
	* [quad-seed](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/pixelseedmergerlayers.html)
* LowPtTripletStep
    * [main cfg](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/lowPtTripletStepSeeds.html)
	* [used layers](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/lowPtTripletStepSeedLayers.html)
* DetachedQuadStep
    * [main cfg](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/detachedQuadStepSeeds.html)
	* [used layers](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/detachedQuadStepSeedLayers.html)
	* [quad-seed](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/pixelseedmergerlayers.html)
* PixelPairStep
    * [main cfg](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/pixelPairStepSeeds.html)
	* [used layers](https://roverepublic.web.cern.ch/roverepublic/Sequences/CMSSW_6_2_0_SLHC14/html/pixelPairStepSeedLayers.html)







